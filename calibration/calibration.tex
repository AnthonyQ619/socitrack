\documentclass{article}

\usepackage[top=.75in, bottom=.75in]{geometry}

\usepackage{amsmath}
\usepackage{xcolor}

\begin{document}

\newcommand{\tda}[1]{\textcolor{red}{#1}}
\newcommand{\tdb}[1]{\textcolor{orange}{#1}}
\newcommand{\tdc}[1]{\textcolor{blue}{#1}}

\textbf{Setup:} Assume 3 polypoint tags, all 1~m from each other.

\begin{itemize}
  \item Colors are used to distinguish clock domains. Note that the
    calibration factors don't belong to a clock domain.
  \item S = timestamp sent
  \item R = timestamp received
  \item t = tx delay calibration factor (unknown)
  \item r = rx delay calibration factor (unknown)
  \item $\lambda$ = time of flight for 1~m ($\lambda = \frac{1}{c}$)
\end{itemize}

$A:$ Tag 0 sends a packet       %alpha
\begin{align}
  ARX1 &= ATX0 + t_0 + r_1 \\
  ARX2 &= ATX0 + t_0 + r_2
\end{align}

$B:$ Tag 1 replies              %beta
\begin{align}
  BRX0 &= BTX1 + t_1 + r_0 \\
  BRX2 &= BTX1 + t_1 + r_2
\end{align}

$C:$ Tag 1 replies again        %gamma
\begin{align}
  CRX0 &= CTX1 + t_1 + r_0 \\
  CRX2 &= CTX1 + t_1 + r_2
\end{align}

$D:$ Tag 2 sends a packet       %zeta
\begin{align}
  DRX0 &= DTX2 + t_2 + r_0 \\
  DRX1 &= DTX2 + t_2 + r_1
\end{align}

After $\gamma$, we have factors to convert between all of the clock domains:
\[ k_{0\rightarrow1} = \frac{CTX1-BTX1}{CRX0-BRX0} ,%
   k_{1\rightarrow0} = \frac{CRX0-BRX0}{CTX1-BTX1} \]

\[ k_{2\rightarrow1} = \frac{CTX1-BTX1}{CRX2-BRX2} ,%
   k_{1\rightarrow2} = \frac{CRX2-BRX2}{CTX1-BTX1} \]

\[ k_{2\rightarrow0} = k_{2\rightarrow1} * k_{1\rightarrow0}, etc \]

Now, factor in the known time-of-flight:
\[ ARX1 * k_{1\rightarrow0} - ATX0 - \lambda = \Delta_{A,0,1} = t_0 + r_1 \]
\[ ARX2 * k_{2\rightarrow0} - ATX0 - \lambda = \Delta_{A,0,2} = t_0 + r_2 \]

\[ BRX0 * k_{0\rightarrow1} - BTX1 - \lambda = \Delta_{B,1,0} = t_1 + r_0 \]
\[ BRX2 * k_{2\rightarrow1} - BTX1 - \lambda = \Delta_{B,1,2} = t_1 + r_2 \]

Note that $\Delta_{A,0,1} = \Delta_{B,1,0} \leftrightarrow$ the tx and rx delays
are symmetric, which I don't think we can assume is true.

Note that $\Delta_{B,1,2} = \Delta_{C,1,0}$, so using $C$ data
gains us no benefit here.

\[ DRX0 * k_{0\rightarrow2} - DTX2 - \lambda = \Delta_{D,2,0} = t_2 + r_0 \]
\[ DRX1 * k_{1\rightarrow2} - DTX2 - \lambda = \Delta_{D,2,1} = t_2 + r_1 \]

Now we have 6 equations and 6 unknowns. Done.

\end{document}
